
# bind 192.168.2.196:53 to 8053
sudo iptables -t nat -A PREROUTING -p udp -d 192.168.2.169 --dport 53 -j DNAT --to 192.168.2.169:8053

# to remove, use -D instead of -A
# iptables -t nat -D PREROUTING -p udp -d $this_ip --dport 53 -j DNAT --to $this_ip:8053
sudo iptables -t nat -D PREROUTING -p udp -d 192.168.2.196 --dport 53 -j DNAT --to 192.168.2.196:8053


# save iptables
sudo apt install iptables-persistent
sudo iptables-save | sudo tee /etc/iptables/rules.v4

# set to this server to DNS server by all clients by setting in dd-wrt
# Additional Dnsmasq Options
interface=oet1
dhcp-option=option:dns-server,192.168.2.196,192.168.2.1

# Reports
see  personal/apache/cgi-bin


rich@pluto:~$ cat /etc/iptables/rules.v4
# Generated by iptables-save v1.8.7 on Wed Mar 30 17:58:11 2022
*mangle
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:LIBVIRT_PRT - [0:0]
-A POSTROUTING -j LIBVIRT_PRT
-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
COMMIT
# Completed on Wed Mar 30 17:58:11 2022
# Generated by iptables-save v1.8.7 on Wed Mar 30 17:58:11 2022
*filter
:INPUT ACCEPT [30745675:41032887562]
:FORWARD ACCEPT [213:11404]
:OUTPUT ACCEPT [15064769:1843384861]
:LIBVIRT_FWI - [0:0]
:LIBVIRT_FWO - [0:0]
:LIBVIRT_FWX - [0:0]
:LIBVIRT_INP - [0:0]
:LIBVIRT_OUT - [0:0]
-A INPUT -j LIBVIRT_INP
-A FORWARD -j LIBVIRT_FWX
-A FORWARD -j LIBVIRT_FWI
-A FORWARD -j LIBVIRT_FWO
-A OUTPUT -j LIBVIRT_OUT
-A LIBVIRT_FWI -d 192.168.122.0/24 -o virbr0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A LIBVIRT_FWI -o virbr0 -j REJECT --reject-with icmp-port-unreachable
-A LIBVIRT_FWO -s 192.168.122.0/24 -i virbr0 -j ACCEPT
-A LIBVIRT_FWO -i virbr0 -j REJECT --reject-with icmp-port-unreachable
-A LIBVIRT_FWX -i virbr0 -o virbr0 -j ACCEPT
-A LIBVIRT_INP -i virbr0 -p udp -m udp --dport 53 -j ACCEPT
-A LIBVIRT_INP -i virbr0 -p tcp -m tcp --dport 53 -j ACCEPT
-A LIBVIRT_INP -i virbr0 -p udp -m udp --dport 67 -j ACCEPT
-A LIBVIRT_INP -i virbr0 -p tcp -m tcp --dport 67 -j ACCEPT
-A LIBVIRT_OUT -o virbr0 -p udp -m udp --dport 53 -j ACCEPT
-A LIBVIRT_OUT -o virbr0 -p tcp -m tcp --dport 53 -j ACCEPT
-A LIBVIRT_OUT -o virbr0 -p udp -m udp --dport 68 -j ACCEPT
-A LIBVIRT_OUT -o virbr0 -p tcp -m tcp --dport 68 -j ACCEPT
COMMIT
# Completed on Wed Mar 30 17:58:11 2022
# Generated by iptables-save v1.8.7 on Wed Mar 30 17:58:11 2022
*nat
:PREROUTING ACCEPT [111779:15726273]
:INPUT ACCEPT [21581:1814671]
:OUTPUT ACCEPT [9616:889833]
:POSTROUTING ACCEPT [9710:894451]
:LIBVIRT_PRT - [0:0]
-A PREROUTING -d 192.168.2.169/32 -p udp -m udp --dport 53 -j DNAT --to-destination 192.168.2.169:8053
-A POSTROUTING -j LIBVIRT_PRT
-A LIBVIRT_PRT -s 192.168.122.0/24 -d 224.0.0.0/24 -j RETURN
-A LIBVIRT_PRT -s 192.168.122.0/24 -d 255.255.255.255/32 -j RETURN
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p tcp -j MASQUERADE --to-ports 1024-65535
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p udp -j MASQUERADE --to-ports 1024-65535
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -j MASQUERADE
COMMIT
# Completed on Wed Mar 30 17:58:11 2022